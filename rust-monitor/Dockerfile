# ------------------------------------------------------------
# 1. Use official Rust image
# ------------------------------------------------------------
FROM rust:1.82-slim

# ------------------------------------------------------------
# 2. Set working directory
# ------------------------------------------------------------
WORKDIR /app

# ------------------------------------------------------------
# 3. Install dependencies for Rust crates (openssl, etc.)
# ------------------------------------------------------------
RUN apt-get update && apt-get install -y pkg-config libssl-dev && rm -rf /var/lib/apt/lists/*

# ------------------------------------------------------------
# 4. Copy project files
# ------------------------------------------------------------
COPY Cargo.toml ./
COPY src ./src
COPY dashboard.html ./

# ------------------------------------------------------------
# 5. Build release binary
# ------------------------------------------------------------
RUN cargo build --release

# ------------------------------------------------------------
# 6. Expose HTTP port for dashboard + websocket
# ------------------------------------------------------------
EXPOSE 7071

# ------------------------------------------------------------
# 7. Run binary
# ------------------------------------------------------------
CMD ["./target/release/rust-monitor"]
